// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id             Int       @id @default(autoincrement())
  email          String    @unique
  password       String
  name           String
  type           String
  firstLogin     Boolean   @default(true)
  createdAt      DateTime  @default(now())

  exams          Exam[]   

  PasswordRecoveryCode PasswordRecoveryCode[]


  Exam Exam[] @relation("Validators")
}


model PasswordRecoveryCode {
  id         Int      @id @default(autoincrement())
  userId     Int
  code       String
  expiresAt  DateTime

  user       User     @relation(fields: [userId], references: [id])
}


model Patient {
  id             Int       @id @default(autoincrement())
  name           String
  document       String    @unique
  documentType   String
  birthDate      DateTime
  phone          String
  address        String
  gender         String
  race           String
  maritalStatus  String
  educationLevel String
  origin         String
  annualIncome   Float
  createdAt      DateTime  @default(now())

  exams          Exam[]  
}

model Exam {
  id             Int       @id @default(autoincrement())
  patientId      Int?
  userId         Int   
  status         String    @default("in_progress") 
  result         Json?   
  observations   String?  
  validated      Boolean? 
  validatorId    Int?     
  validatedAt    DateTime? 
  createdAt      DateTime  @default(now())
  answers        Json?  
  validationChanges Json?

  patient        Patient?  @relation(fields: [patientId], references: [id], onDelete: SetNull)
  user           User      @relation(fields: [userId], references: [id])
  validator      User?     @relation("Validators", fields: [validatorId], references: [id])
}

